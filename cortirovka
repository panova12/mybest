import os
import shutil
from pathlib import Path

def file_sorter():
    """–°–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤–≤–æ–¥–æ–º –ø—É—Ç–∏"""
    
    categories = {
        'images': ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'],
        'documents': ['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'],
        'audio': ['mp3', 'wav', 'flac', 'aac', 'ogg'],
        'video': ['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'],
        'archives': ['zip', 'rar', '7z', 'tar', 'gz'],
        'code': ['py', 'js', 'html', 'css', 'json', 'xml', 'md'],
        'executables': ['exe', 'msi', 'deb', 'rpm'],
    }
    
    # –ó–∞–ø—Ä–æ—Å –ø—É—Ç–∏
    source_dir = input("–í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: ").strip()
    
    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –∏—Ö –ø–æ –æ—à–∏–±–∫–µ
    if source_dir.startswith('source '):
        source_dir = source_dir.replace('source ', '')
    if '/.venv/bin/activate' in source_dir:
        source_dir = source_dir.replace('/.venv/bin/activate', '')
    
    source_path = Path(source_dir)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if not source_path.exists():
        print(f"‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è '{source_dir}' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞")
        return
    
    if not source_path.is_dir():
        print(f"‚ùå '{source_dir}' –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π!")
        return
    
    files_processed = 0
    
    print(f"\nüîç –ù–∞—á–∏–Ω–∞—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –≤: {source_path}")
    print("=" * 50)
    
    for file_path in source_path.iterdir():
        if file_path.is_file():
            # –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
            extension = file_path.suffix.lower()
            if extension:
                extension = extension[1:]  # —É–±–∏—Ä–∞–µ–º —Ç–æ—á–∫—É
            else:
                extension = 'no_extension'
            
            # –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            found_category = 'other'
            for category, extensions in categories.items():
                if extension in extensions:
                    found_category = category
                    break
            
            # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            category_dir = source_path / found_category
            category_dir.mkdir(exist_ok=True)
            
            # –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∞–π–ª
            try:
                target_path = category_dir / file_path.name
                if target_path.exists():
                    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –µ—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    counter = 1
                    while target_path.exists():
                        new_name = f"{file_path.stem}_{counter}{file_path.suffix}"
                        target_path = category_dir / new_name
                        counter += 1
                
                shutil.move(str(file_path), str(target_path))
                print(f"‚úì {file_path.name} ‚Üí {found_category}/")
                files_processed += 1
                
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ —Å {file_path.name}: {e}")
    
    print("=" * 50)
    print(f"üéâ –ì–æ—Ç–æ–≤–æ! –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {files_processed}")

# –ó–∞–ø—É—Å–∫
if __name__ == "__main__":
    file_sorter()